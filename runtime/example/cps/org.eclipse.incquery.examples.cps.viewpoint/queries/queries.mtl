[comment encoding = UTF-8 /]
[module queries('http://org.eclipse.incquery/model/cps')]

[query public stateIsReachable(initialState : State, state: State) : Boolean = 
	reachableStates(initialState)->includes(state)
/]

[query public reachableStates(initialState : State) : OrderedSet(State) =
	initialState->closure(v: State | v.outgoingTransitions.targetState)
/]

[query public numOfUnReachableStates(appType: ApplicationType): Integer =
	(appType.behavior.states->size()) - (appType.behavior.initial->closure(v: State | v.outgoingTransitions.targetState)->size())
/]

[query public connectionEmpty (anApplicationType : ApplicationType) : Collection(ApplicationType) = 
self.cps.appTypes->select(a : ApplicationType |
	(not self.instances->select(allocatedTo <> null).allocatedTo.communicateWith->asSet ()->intersection(a.instances->select(allocatedTo <> null).allocatedTo->asSet())->isEmpty())  
	and 
	(not self.behavior.states.outgoingTransitions.action->select(v:String|v <> null)->asSet()->isEmpty() )
	and
	(not a.behavior.states.outgoingTransitions.action->select(v:String|v <> null)->asSet()->isEmpty() ) 
)
/]

[query public connections (anApplicationType : ApplicationType) : Collection(ApplicationType) = 
self.cps.appTypes->select(a : ApplicationType |
	(not self.instances->select(allocatedTo <> null).allocatedTo.communicateWith->asSet ()->intersection(a.instances->select(allocatedTo <> null).allocatedTo->asSet())->isEmpty())  
	and 
	(self.behavior.states.outgoingTransitions.action->select(v:String|v <> null and v.startsWith('sendSignal'))->size() > 0 )
	and
	(a.behavior.states.outgoingTransitions.action->select(v:String|v <> null and v.startsWith('waitForSignal'))->size() > 0 ) 
)

/]

[query public connectios_trial(anApplicationType : ApplicationType) : Collection(ApplicationType) = 
self.cps.appTypes->select(a : ApplicationType |
	( not a.behavior.states.outgoingTransitions.action->select(v:String|v <> null)->isEmpty() ) 
)

/]

